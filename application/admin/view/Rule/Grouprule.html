<form method="post" action="" class="form-horizontal" id="addform">
    <div class="form-group">
        <label class="col-sm-2 control-label">角色名称：</label>
        <div class="col-sm-6">
            <label class="control-label" id="groupname"></label>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">角色权限：</label>
        <div class="col-sm-6">
            <div id="tree"></div>
        </div>
    </div>
</form>
<script type="text/javascript">
    $(function () {
        getGroupInfo('{$id}');
    });

    //get Group info
    function getGroupInfo(id) {
        $.ajax({
            cache: true,
            type: "GET",
            url: "/api/group/" + id,
            async: false,
            error: function (request) {
                alert("连接错误");
            },
            success: function (data) {
                $("#groupname").html(data.title);
            }
        });
    }

    //get tree
    function getTree() {
        var data = [
            {
                text: "Parent 1",
                nodes: [
                    {
                        text: "Child 1",
                        nodes: [
                            {
                                text: "Grandchild 1"
                            },
                            {
                                text: "Grandchild 2"
                            }
                        ]
                    },
                    {
                        text: "Child 2"
                    }
                ]
            },
            {
                text: "Parent 2"
            },
            {
                text: "Parent 3"
            },
            {
                text: "Parent 4"
            },
            {
                text: "Parent 5"
            }
        ];
        // Some logic to retrieve, or generate tree structure
        return data;
    }

    $('#tree').treeview({
        data: getTree(),
        showCheckbox: true,
        onNodeChecked: function(event, node) { //选中节点
            var selectNodes = getNodeIdArr(node);//获取所有子节点
            if(selectNodes){ //子节点不为空，则选中所有子节点
                $('#tree').treeview('checkNode', [ selectNodes,{ silent: true }]);
            }
        },
        onNodeUnchecked: function (event, node) { //取消选中节点
            var selectNodes = getNodeIdArr(node);//获取所有子节点
            if(selectNodes){ //子节点不为空，则取消选中所有子节点
                $('#tree').treeview('uncheckNode', [ selectNodes,{ silent: true }]);
            }
        }
    });

    //递归获取所有的结点id
    function getNodeIdArr( node ){
        var ts = [];
        if(node.nodes){
            for(x in node.nodes){
                ts.push(node.nodes[x].nodeId)
                if(node.nodes[x].nodes){
                    var getNodeDieDai = getNodeIdArr(node.nodes[x]);
                    for(j in getNodeDieDai){
                        ts.push(getNodeDieDai[j]);
                    }
                }
            }
        }else{
            ts.push(node.nodeId);
        }
        return ts;
    }

</script>